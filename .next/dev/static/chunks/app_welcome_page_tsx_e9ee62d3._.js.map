{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Victus/Desktop/Course_Project/app/welcome/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { FormEvent, useEffect, useRef, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ninterface Idea {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  status?: string;\r\n  createdAt?: string;\r\n  attachments?: {\r\n    id: string;\r\n    filename: string;\r\n    url: string;\r\n    mimetype: string;\r\n    size: number;\r\n  }[];\r\n}\r\n\r\nexport default function WelcomePage() {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState<string | null>(null);\r\n  const [accessToken, setAccessToken] = useState<string | null>(null);\r\n\r\n  const [title, setTitle] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [category, setCategory] = useState(\"\");\r\n  const [files, setFiles] = useState<File[]>([]);\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n\r\n  const [ideas, setIdeas] = useState<Idea[]>([]);\r\n  const [loadingIdeas, setLoadingIdeas] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  const allowedExtensions = [\"pdf\", \"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\"] as const;\r\n\r\n  const isAllowedFile = (file: File) => {\r\n    const parts = file.name.split(\".\");\r\n    if (parts.length < 2) return false;\r\n    const ext = parts[parts.length - 1].toLowerCase();\r\n    return allowedExtensions.includes(ext as (typeof allowedExtensions)[number]);\r\n  };\r\n\r\n  const renderStatus = (status?: string) => {\r\n    switch (status) {\r\n      case \"ACCEPTED\":\r\n        return \"Accepted\";\r\n      case \"REJECTED\":\r\n        return \"Rejected\";\r\n      case \"UNDER_REVIEW\":\r\n        return \"Under review\";\r\n      case \"SUBMITTED\":\r\n      default:\r\n        return \"Submitted\";\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const token = typeof window !== \"undefined\" ? window.localStorage.getItem(\"accessToken\") : null;\r\n    const storedEmail = typeof window !== \"undefined\" ? window.localStorage.getItem(\"userEmail\") : null;\r\n\r\n    if (!token) {\r\n      router.replace(\"/login\");\r\n      return;\r\n    }\r\n\r\n    setEmail(storedEmail);\r\n    setAccessToken(token);\r\n    void loadIdeas(token);\r\n  }, [router]);\r\n\r\n  const loadIdeas = async (token: string) => {\r\n    setLoadingIdeas(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(\"http://localhost:3000/api/ideas\", {\r\n        method: \"GET\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      if (!res.ok) {\r\n        setError(`Failed to load ideas (${res.status}). Please try again later.`);\r\n        return;\r\n      }\r\n      const data = (await res.json()) as Idea[];\r\n      setIdeas(data || []);\r\n    } catch (err: any) {\r\n      setError(err?.message ?? \"Failed to load ideas\");\r\n    } finally {\r\n      setLoadingIdeas(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault();\r\n    if (!accessToken) {\r\n      router.replace(\"/login\");\r\n      return;\r\n    }\r\n    setError(null);\r\n    setSuccess(null);\r\n\r\n    if (!title || !description || !category) {\r\n      setError(\"Title, description and category are required.\");\r\n      return;\r\n    }\r\n\r\n    // Validate attachments (if any) before sending to backend.\r\n    const invalidFiles = files.filter((f) => !isAllowedFile(f));\r\n    if (invalidFiles.length > 0) {\r\n      setError(\"Only document files (pdf, doc, docx, xls, xlsx, ppt, pptx) are allowed.\");\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      const res = await fetch(\"http://localhost:3000/api/ideas\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${accessToken}`,\r\n        },\r\n        body: JSON.stringify({ title, description, category }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => null);\r\n        const msg = body?.error?.message || `Failed to create idea (${res.status})`;\r\n        throw new Error(msg);\r\n      }\r\n\r\n      const created = (await res.json()) as Idea;\r\n\r\n      // Optional: multiple attachments per idea (metadata only).\r\n      let optimisticAttachments: Idea[\"attachments\"] | undefined;\r\n      if (files.length > 0) {\r\n        try {\r\n          await Promise.all(\r\n            files.map((file) =>\r\n              fetch(\"http://localhost:3000/api/ideas/attach\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                  \"Content-Type\": \"application/json\",\r\n                  Authorization: `Bearer ${accessToken}`,\r\n                },\r\n                body: JSON.stringify({\r\n                  ideaId: created.id,\r\n                  filename: file.name,\r\n                  url: `/attachments/${encodeURIComponent(file.name)}`,\r\n                  mimetype: file.type || \"application/octet-stream\",\r\n                  size: file.size,\r\n                }),\r\n              })\r\n            )\r\n          );\r\n\r\n          optimisticAttachments = files.map((file, index) => ({\r\n            id: `${created.id}-attachment-${index}`,\r\n            filename: file.name,\r\n            url: `/attachments/${encodeURIComponent(file.name)}`,\r\n            mimetype: file.type || \"application/octet-stream\",\r\n            size: file.size,\r\n          }));\r\n        } catch {\r\n          // attachment hatası ana akışı bozmasın\r\n        }\r\n      }\r\n\r\n      // Optimistic update: backend'den liste çekilemese bile yeni fikri lokalde göster.\r\n      setIdeas((prev) => [\r\n        {\r\n          ...created,\r\n          attachments: optimisticAttachments ?? created.attachments,\r\n        },\r\n        ...prev,\r\n      ]);\r\n\r\n      setTitle(\"\");\r\n      setDescription(\"\");\r\n      setCategory(\"\");\r\n      setFiles([]);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = \"\";\r\n      }\r\n      setSuccess(\"Idea submitted successfully.\");\r\n      // Backend listelemesi hata verse bile form başarılı kabul edilsin.\r\n      await loadIdeas(accessToken);\r\n    } catch (err: any) {\r\n      setError(err?.message ?? \"Failed to create idea\");\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main className=\"welcome-page\">\r\n      <section className=\"welcome-header\">\r\n        <h1>Welcome{email ? `, ${email}` : \"\"}</h1>\r\n        <p>From here you can submit a new idea and see your own ideas.</p>\r\n      </section>\r\n\r\n      <section className=\"card\" aria-labelledby=\"idea-form-heading\">\r\n        <h2 id=\"idea-form-heading\">Submit new idea</h2>\r\n        <form onSubmit={handleSubmit} className=\"idea-form\">\r\n          <div className=\"idea-form-field\">\r\n            <label htmlFor=\"title\">Title</label>\r\n            <input\r\n              id=\"title\"\r\n              name=\"title\"\r\n              type=\"text\"\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"idea-form-field\">\r\n            <label htmlFor=\"description\">Description</label>\r\n            <textarea\r\n              id=\"description\"\r\n              name=\"description\"\r\n              value={description}\r\n              onChange={(e) => setDescription(e.target.value)}\r\n              required\r\n              rows={4}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"idea-form-field\">\r\n            <label htmlFor=\"category\">Category</label>\r\n            <input\r\n              id=\"category\"\r\n              name=\"category\"\r\n              type=\"text\"\r\n              value={category}\r\n              onChange={(e) => setCategory(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"idea-form-field\">\r\n            <label htmlFor=\"attachment\">Attachment (single file)</label>\r\n            <input\r\n              id=\"attachment\"\r\n              name=\"attachment\"\r\n              type=\"file\"\r\n              multiple\r\n              ref={fileInputRef}\r\n              onChange={(e) => setFiles(e.target.files ? Array.from(e.target.files) : [])}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"idea-form-actions\">\r\n            <button type=\"submit\" disabled={submitting} className=\"btn\">\r\n              {submitting ? \"Submitting...\" : \"Submit idea\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n        {error && (\r\n          <div role=\"alert\" style={{ color: \"red\", marginTop: \"0.5rem\" }}>\r\n            {error}\r\n          </div>\r\n        )}\r\n        {success && (\r\n          <div role=\"status\" style={{ color: \"green\", marginTop: \"0.5rem\" }}>\r\n            {success}\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      <section className=\"card\" aria-labelledby=\"idea-list-heading\">\r\n        <h2 id=\"idea-list-heading\">Your ideas</h2>\r\n        {loadingIdeas ? (\r\n          <p>Loading...</p>\r\n        ) : ideas.length === 0 ? (\r\n          <p>You do not have any ideas yet.</p>\r\n        ) : (\r\n          <ul>\r\n            {ideas.map((idea) => (\r\n              <li key={idea.id} className=\"idea-item\">\r\n                <h3>{idea.title}</h3>\r\n                <p>{idea.description}</p>\r\n                <p>\r\n                  <strong>Category:</strong> {idea.category}\r\n                </p>\r\n                {idea.status && (\r\n                  <p>\r\n                    <strong>Status:</strong> {renderStatus(idea.status)}\r\n                  </p>\r\n                )}\r\n                {idea.attachments && idea.attachments.length > 0 && (\r\n                  <div style={{ marginTop: \"0.25rem\" }}>\r\n                    <strong>Attachment:</strong>{\" \"}\r\n                    {idea.attachments.map((att) => (\r\n                      <span key={att.id}>\r\n                        <a href={att.url} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                          {att.filename}\r\n                        </a>\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}