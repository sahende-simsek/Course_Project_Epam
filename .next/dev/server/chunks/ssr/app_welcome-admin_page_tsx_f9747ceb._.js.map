{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Victus/Desktop/Course_Project/app/welcome-admin/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ninterface Idea {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  status?: string;\r\n  attachments?: {\r\n    id: string;\r\n    filename: string;\r\n    url: string;\r\n    mimetype: string;\r\n    size: number;\r\n  }[];\r\n}\r\n\r\nexport default function WelcomeAdminPage() {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState<string | null>(null);\r\n  const [accessToken, setAccessToken] = useState<string | null>(null);\r\n\r\n  const [ideas, setIdeas] = useState<Idea[]>([]);\r\n  const [loadingIdeas, setLoadingIdeas] = useState(false);\r\n  const [evaluationComment, setEvaluationComment] = useState<Record<string, string>>({});\r\n  const [evaluatingId, setEvaluatingId] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    const token = window.localStorage.getItem(\"accessToken\");\r\n    const storedEmail = window.localStorage.getItem(\"userEmail\");\r\n\r\n    if (!token) {\r\n      router.replace(\"/login\");\r\n      return;\r\n    }\r\n\r\n    // Role guard: evaluator-only dashboard\r\n    try {\r\n      const parts = token.split(\".\");\r\n      if (parts.length === 3) {\r\n        const payload = JSON.parse(atob(parts[1].replace(/-/g, \"+\").replace(/_/g, \"/\")));\r\n        if (payload?.role !== \"EVALUATOR\") {\r\n          router.replace(\"/welcome\");\r\n          return;\r\n        }\r\n      }\r\n    } catch {\r\n      router.replace(\"/login\");\r\n      return;\r\n    }\r\n\r\n    setEmail(storedEmail);\r\n    setAccessToken(token);\r\n    void loadIdeas(token);\r\n  }, [router]);\r\n\r\n  const loadIdeas = async (token: string) => {\r\n    setLoadingIdeas(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(\"http://localhost:3000/api/ideas\", {\r\n        method: \"GET\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      if (!res.ok) {\r\n        setError(`Failed to load ideas (${res.status}). Please try again later.`);\r\n        return;\r\n      }\r\n      const data = (await res.json()) as Idea[];\r\n      setIdeas(data || []);\r\n    } catch (err: any) {\r\n      setError(err?.message ?? \"Failed to load ideas\");\r\n    } finally {\r\n      setLoadingIdeas(false);\r\n    }\r\n  };\r\n\r\n  const handleEvaluate = async (ideaId: string, decision: \"ACCEPTED\" | \"REJECTED\") => {\r\n    if (!accessToken) {\r\n      router.replace(\"/login\");\r\n      return;\r\n    }\r\n    const comment = evaluationComment[ideaId]?.trim();\r\n    if (!comment) {\r\n      setError(\"Please enter a comment before submitting a decision.\");\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n    setSuccess(null);\r\n    setEvaluatingId(ideaId);\r\n    try {\r\n      const res = await fetch(\"http://localhost:3000/api/evaluations\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${accessToken}`,\r\n        },\r\n        body: JSON.stringify({ ideaId, decision, comments: comment }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => null);\r\n        const msg = body?.error?.message || `Failed to submit evaluation (${res.status})`;\r\n        throw new Error(msg);\r\n      }\r\n\r\n      setIdeas((prev) =>\r\n        prev.map((idea) =>\r\n          idea.id === ideaId\r\n            ? {\r\n                ...idea,\r\n                status: decision,\r\n              }\r\n            : idea\r\n        )\r\n      );\r\n      setEvaluationComment((prev) => ({ ...prev, [ideaId]: \"\" }));\r\n      setSuccess(`Decision saved as ${decision.toLowerCase()}.`);\r\n    } catch (err: any) {\r\n      setError(err?.message ?? \"Failed to submit evaluation\");\r\n    } finally {\r\n      setEvaluatingId(null);\r\n    }\r\n  };\r\n\r\n  const renderStatus = (status?: string) => {\r\n    switch (status) {\r\n      case \"ACCEPTED\":\r\n        return \"Accepted\";\r\n      case \"REJECTED\":\r\n        return \"Rejected\";\r\n      case \"UNDER_REVIEW\":\r\n        return \"Under review\";\r\n      case \"SUBMITTED\":\r\n      default:\r\n        return \"Submitted\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main className=\"welcome-page\">\r\n      <section className=\"welcome-header\">\r\n        <h1>Admin / Evaluator Dashboard{email ? `, ${email}` : \"\"}</h1>\r\n        <p>You are signed in with evaluator privileges and can review ideas.</p>\r\n      </section>\r\n\r\n      <section className=\"card\" aria-labelledby=\"idea-review-heading\">\r\n        <h2 id=\"idea-review-heading\">Idea review queue</h2>\r\n        {error && (\r\n          <div role=\"alert\" style={{ color: \"red\", marginBottom: \"0.5rem\" }}>\r\n            {error}\r\n          </div>\r\n        )}\r\n        {success && (\r\n          <div role=\"status\" style={{ color: \"green\", marginBottom: \"0.5rem\" }}>\r\n            {success}\r\n          </div>\r\n        )}\r\n        {loadingIdeas ? (\r\n          <p>Loading ideas...</p>\r\n        ) : ideas.length === 0 ? (\r\n          <p>There are no ideas to review yet.</p>\r\n        ) : (\r\n          <ul>\r\n            {ideas.map((idea) => (\r\n              <li key={idea.id} className=\"idea-item\">\r\n                <h3>{idea.title}</h3>\r\n                <p>{idea.description}</p>\r\n                <p>\r\n                  <strong>Category:</strong> {idea.category}\r\n                </p>\r\n                <p>\r\n                  <strong>Status:</strong> {renderStatus(idea.status)}\r\n                </p>\r\n                {idea.attachments && idea.attachments.length > 0 && (\r\n                  <div style={{ marginTop: \"0.25rem\" }}>\r\n                    <strong>Attachments:</strong>{\" \"}\r\n                    {idea.attachments.map((att) => (\r\n                      <span key={att.id}>\r\n                        <a href={att.url} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                          {att.filename}\r\n                        </a>\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                {idea.status !== \"ACCEPTED\" && idea.status !== \"REJECTED\" && (\r\n                  <>\r\n                    <div className=\"idea-form-field\" style={{ marginTop: \"0.5rem\" }}>\r\n                      <label htmlFor={`comment-${idea.id}`}>Evaluation comment</label>\r\n                      <textarea\r\n                        id={`comment-${idea.id}`}\r\n                        value={evaluationComment[idea.id] ?? \"\"}\r\n                        onChange={(e) =>\r\n                          setEvaluationComment((prev) => ({\r\n                            ...prev,\r\n                            [idea.id]: e.target.value,\r\n                          }))\r\n                        }\r\n                        rows={3}\r\n                      />\r\n                    </div>\r\n                    <div className=\"idea-form-actions\">\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"btn\"\r\n                        disabled={evaluatingId === idea.id}\r\n                        onClick={() => handleEvaluate(idea.id, \"ACCEPTED\")}\r\n                      >\r\n                        {evaluatingId === idea.id ? \"Saving...\" : \"Accept\"}\r\n                      </button>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"btn secondary\"\r\n                        disabled={evaluatingId === idea.id}\r\n                        onClick={() => handleEvaluate(idea.id, \"REJECTED\")}\r\n                      >\r\n                        {evaluatingId === idea.id ? \"Saving...\" : \"Reject\"}\r\n                      </button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}